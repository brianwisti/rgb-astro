---
/** List articles published in this section during the given year. */
import BaseLayout from 'layout:BaseLayout';
import ArticleListEntry from 'component:ArticleListEntry.astro';

export async function getStaticPaths() {
    const sections = ['post', 'note'];
    const articles = Astro.fetchContent('../**/*.md');
    let params = [];

    sections.forEach((section) => {
      let articlesForYear = {};

      const sectionArticles = articles.filter((article) => {
          return article.url.split("/")[1] == section
      });

      sectionArticles.forEach((article) => {
        const year = new Date(article.date).getFullYear().toString();

        if (articlesForYear[year] === undefined) {
          articlesForYear[year] = [];
        }

        articlesForYear[year].push(article);
      });

      for (const [year, articles] of Object.entries(articlesForYear)) {
        const sortedArticles = articles.sort((a, b) =>
          new Date(b.date).valueOf() - new Date(a.date).valueOf()
        );

        params.push({
          params: {
            section: section,
            year: year,
          },
          props: { articles: sortedArticles },
        });
      }
    });

    return params;
}

const { section, year } = Astro.request.params;
const { articles } = Astro.props;

let content = {
    title: `${section}: ${year}`
}
---
<BaseLayout content={content}>
  <h1>{ content.title }</h1>
  {articles.map((article) => <ArticleListEntry article={article} />)}
</BaseLayout>
